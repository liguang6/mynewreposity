<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="com.byd.wms.business.modules.out.dao.DispatchingDeliveryDao">
	<select id="list" resultType="Map" parameterType="Map">
		SELECT 
		DISPATCHING_NO DELIVERY_NO,
		DISPATCHING_ITEM_NO DELIVERY_ITEM_NO,
		KANBAN_NO REQUIREMENT_NO,
		ITEM.REQUIREMENT_NO WMS_REQUIREMENT_NO,
		ITEM.REQUIREMENT_ITEM_NO WMS_REQUIREMENT_ITEM_NO,
		WWCM.WH_NUMBER WAREHOUSE_CODE,
		WWCM.WERKS PLCD,
		ITEM.LGORT LOCD,
		ITEM.MATNR,
		ITEM.MAKTX MATEDS,
		ITEM.QTY_XJ QUANTY,
		ITEM.STATION,
		WWCM.POU,
		WWCM.LINE_NO PRODUCTION_LINE,
		TASK.BATCH,
		WWCM.DELIVERY_ROUTE DELIVERYROUTE,
		WWCM.LINE_FEEDING_ROUTE LINEFEEDINGROUTE,
		WWCM.DELIVERY_TYPE DELIVERYTYPE,
		WWCM.START_SHIPPING_TIME DELIVERYTIME,
		TASK.SOBKZ STTPNM,		
		WWCM.RECEIVE_PLCD RECEIVEPLCD,
		ITEM.RECEIVE_LGORT RECEIVELOCD,
		WWCM.REFERENCE_TYPE RECEIVELOCDTYPE,
		WWCM.RMARK,
		TASK.TASK_NUM,
		TASK.LABEL_NO,
		TASK.MOULD_NO
		<!--  
		RFID_No		
		Trailer_ID
		-->
		FROM 
		WMS_OUT_REQUIREMENT_ITEM ITEM
		LEFT JOIN WMS_WS_CALL_MATERIAL WWCM
		ON ITEM.DISPATCHING_NO = WWCM.DELIVERY_NO AND ITEM.DISPATCHING_ITEM_NO = WWCM.DLV_ITEM
		LEFT JOIN WMS_OUT_REQUIREMENT_HEAD HEAD
		ON ITEM.REQUIREMENT_NO = HEAD.REQUIREMENT_NO
		LEFT JOIN WMS_CORE_WH_TASK TASK
		ON TASK.REFERENCE_DELIVERY_NO = ITEM.REQUIREMENT_NO AND TASK.REFERENCE_DELIVERY_ITEM = ITEM.REQUIREMENT_ITEM_NO
		WHERE ITEM.BUSINESS_NAME = '77' AND TASK.WT_STATUS='02'  
	</select>
	
	<select id="getLabelInfo" parameterType="Map" resultType="Map">
		SELECT L.* FROM WMS_CORE_LABEL L WHERE L.LABEL_NO = #{LABEL_NO}
	</select>
	
	<insert id="insertHead" parameterType="Map">
		INSERT INTO
		WMS_OUT_DELIVERY_HEAD VALUES(
		SEQ_WMS_OUT_DELIVERY_HEAD.nextval,
		#{DELIVERY_NO},#{WH_NUMBER},#{WERKS},#{STATUS},#{DELIVERY_TYPE},#{DELIVERY_TIME},#{RECEIVE_PLCD},
		#{RECEIVE_LOCD},#{RECEIVE_TYPE},#{CREATOR},#{CREATE_DATE},#{EDITOR},#{EDIT_DATE},'0',#{RMARK})
	</insert>

	<insert id="insertItem" parameterType="List">
		INSERT INTO WMS_OUT_DELIVERY_ITEM (
		ID ,
		DELIVERY_NO ,
		DELIVERY_ITEM_NO ,
		ITEM_STATUS ,
		WLMS_DELIVERY_NO ,
		WLMS_DELIVERY_ITEM_NO,
		WLMS_REQUIREMENT_NO ,
		REQUIREMENT_NO ,
		REQUIREMENT_ITEM_NO ,
		TASK_NUM ,
		LGORT ,
		MATNR ,
		MAKTX ,
		QTY ,
		POU ,
		STATION ,
		LINE_NO ,
		BATCH ,
		DELIVERY_ROUTE ,
		LINE_FEEDING_ROUTE ,
		LIFNR ,
		LIKTX ,
		SOBKZ ,
		MOTYPE ,
		RFID_NO ,
		LABEL_NO ,
		MOULD_NO ,
		CREATOR ,
		CREATE_DATE ,
		EDITOR ,
		EDIT_DATE
		)
		SELECT
		SEQ_WMS_OUT_DELIVERY_ITEM.NEXTVAL,m.* from(
		<foreach collection="list" item="d" index="index" separator="union all">
			SELECT
			#{d.DELIVERY_NO},#{d.DELIVERY_ITEM_NO},#{d.ITEM_STATUS},#{d.WLMS_DELIVERY_NO},#{d.WLMS_DELIVERY_ITEM_NO}
			,#{d.WLMS_REQUIREMENT_NO},#{d.REQUIREMENT_NO},#{d.REQUIREMENT_ITEM_NO},#{d.TASK_NUM},#{d.LGORT},#{d.MATNR},#{d.MAKTX},#{d.QTY}
			,#{d.POU},#{d.STATION},#{d.LINE_NO},#{d.BATCH},#{d.DELIVERY_ROUTE},#{d.LINE_FEEDING_ROUTE},#{d.LIFNR},#{d.LIKTX},#{d.SOBKZ},#{d.MOTYPE},#{d.RFID_NO}
			,#{d.LABEL_NO},#{d.MOULD_NO},#{d.CREATOR},#{d.CREATE_DATE},#{d.EDITOR},#{d.EDIT_DATE}
			FROM DUAL
		</foreach>
		) m
	</insert>
</mapper>