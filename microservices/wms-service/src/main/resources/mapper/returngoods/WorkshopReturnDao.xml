<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.byd.wms.business.modules.returngoods.dao.WorkshopReturnDao">
	<select id="getBusinessNameListByWerks" parameterType="Map" resultType="Map">
	SELECT DISTINCT B.BUSINESS_NAME,D.VALUE,B.BUSINESS_CLASS,B.BUSINESS_TYPE FROM WMS_C_WMS_BUSINESS B
	LEFT JOIN SYS_DICT D ON B.BUSINESS_NAME = D.CODE AND D."TYPE" = 'BUSINESS_NAME'
	WHERE B.BUSINESS_CLASS = '06' 
	AND B.BUSINESS_CODE IN (SELECT BUSINESS_CODE FROM WMS_C_PLANT_BUSINESS WHERE WERKS = #{WERKS})
	ORDER BY B.BUSINESS_NAME
	</select>
	
	<select id="getSapVendorInfo" parameterType="Map" resultType="Map">
	SELECT * FROM WMS_SAP_VENDOR WHERE LIFNR = #{LIFNR}
	</select>
	
	<select id="getWorkshopReturnData" parameterType="Map" resultType="Map">
	SELECT C.AUFNR,C.POSNR,C.RSNUM,C.RSPOS,C.MATNR,M.MAKTX,C.MEINS,C.TL_QTY,' ' AS QTY1 ,' ' AS REASON ,' ' AS SQE,
	C.LGORT,NVL(C.SOBKZ,'Z') SOBKZ,
	(SELECT COUNT(*) FROM WMS_C_PLANT_BUSINESS WHERE WERKS = C.WERKS AND BUSINESS_CODE IN 
	(SELECT BUSINESS_CODE FROM WMS_C_WMS_BUSINESS WHERE BUSINESS_CLASS = '06')) PC_COUNT,
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE MO_NO=C.AUFNR AND MO_ITEM_NO = C.POSNR
	AND ITEM_STATUS='00' AND DEL = '0'
	),0) RETURN_QTY, --已创单数量
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE MO_NO=C.AUFNR AND MO_ITEM_NO = C.POSNR
	AND ITEM_STATUS='02' AND DEL = '0'
	),0) FINISH_QTY --已交接数量
	FROM WMS_SAP_MO_COMPONENT C
	LEFT JOIN WMS_SAP_MATERIAL M ON C.MATNR = M.MATNR AND C.WERKS = M.WERKS
	WHERE C.WERKS = #{WERKS} AND C.BWART = '261' AND NVL(C.RGEKZ,'0') != 'X' AND C.AUFNR IN ${AUFNRS} 
	AND NVL(C.TL_QTY,0)>0
	<if test="MATNRS !=null and MATNRS !=''">
	AND C.MATNR IN ${MATNRS} 
	</if>
	</select>
	
	<select id="getWorkshopReturnData36" parameterType="Map" resultType="Map">
	--BUG1139 重写36 生产订单退料(不冲预留262)取值逻辑
	SELECT RI.MO_NO AUFNR,RI.MO_ITEM_NO RSPOS,RI.RSNUM,RI.REQUIREMENT_NO,RI.REQUIREMENT_ITEM_NO,RI.MATNR,
	RI.MAKTX,RI.UNIT AS MEINS,RI.LGORT,RI.SOBKZ,
	' ' AS REASON ,' ' AS SQE,RI.IO_NO,
	(SELECT COUNT(*) FROM WMS_C_PLANT_BUSINESS WHERE WERKS = RH.WERKS AND BUSINESS_CODE IN 
	(SELECT BUSINESS_CODE FROM WMS_C_WMS_BUSINESS WHERE BUSINESS_CLASS = '06')) PC_COUNT,
	
	(SELECT NVL(SUM(I.QTY_REAL),0) - NVL(SUM(I.QTY_CANCEL),0) AS TL_QTY FROM WMS_OUT_REQUIREMENT_ITEM I
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD H ON I.REQUIREMENT_NO = H.REQUIREMENT_NO WHERE
	H.WERKS = #{WERKS} AND H.WH_NUMBER = #{WH_NUMBER} AND I.BUSINESS_NAME = '42' AND I.BUSINESS_TYPE = '10'
	AND I.REQ_ITEM_STATUS IN ('04','05','06') AND I.MO_NO = RI.MO_NO AND I.MATNR = RI.MATNR
	) TL_QTY,
	
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE WERKS = #{WERKS} AND WH_NUMBER = #{WH_NUMBER} AND 
	MO_NO = #{AUFNRS} AND MATNR = RI.MATNR
	AND ITEM_STATUS='00' AND DEL = '0' AND BUSINESS_NAME = '36' AND BUSINESS_TYPE = '10'
	),0) RETURN_QTY, --已创单数量
	
	NVL((SELECT SUM(FD.REAL_QTY) FROM WMS_OUT_RETURN_ITEM_D FD LEFT JOIN WMS_OUT_RETURN_ITEM FI 
	ON FD.RETURN_NO = FI.RETURN_NO AND FD.RETURN_ITEM_NO = FI.RETURN_ITEM_NO
	WHERE FI.WERKS = #{WERKS} AND FI.WH_NUMBER = #{WH_NUMBER} AND FI.MO_NO = RI.MO_NO AND FD.MATNR = RI.MATNR 
	AND FI.ITEM_STATUS='02' AND FI.DEL = '0' AND FI.BUSINESS_NAME = '36' AND FI.BUSINESS_TYPE = '10'
	),0) FINISH_QTY, --已交接数量	
	
	(SELECT NVL(SUM(WI.QTY_CANCEL),0) FROM WMS_CORE_WMSDOC_ITEM WI WHERE 
	WI.RETURN_NO = RE_I.RETURN_NO AND WI.RETURN_ITEM_NO = RE_I.RETURN_ITEM_NO
	) QX_QTY 		--取消/冲销数量
	FROM WMS_OUT_REQUIREMENT_ITEM RI 
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD RH ON RI.REQUIREMENT_NO = RH.REQUIREMENT_NO	
	LEFT JOIN WMS_OUT_RETURN_ITEM RE_I ON RE_I.MO_NO = RI.MO_NO AND RE_I.MO_ITEM_NO = RI.MO_ITEM_NO
	WHERE RH.WERKS = #{WERKS} AND RH.WH_NUMBER = #{WH_NUMBER} AND RI.BUSINESS_NAME = '42' AND RI.BUSINESS_TYPE = '10'
	AND RI.REQ_ITEM_STATUS IN ('04','05','06') AND RI.MO_NO IN ${AUFNRS} 
	<if test="MATNRS !=null and MATNRS !=''">
	AND RI.MATNR IN ${MATNRS} 
	</if>
	</select>
	
	<select id="getWorkshopReturnData37" parameterType="Map" resultType="Map">
	-- BUG1142
	SELECT RI.REQUIREMENT_NO,RI.REQUIREMENT_ITEM_NO,RI.MATNR,RI.MAKTX,RI.UNIT AS MEINS,RI.LGORT,RI.SOBKZ,
	' ' AS REASON ,' ' AS SQE,RI.IO_NO,
	(SELECT COUNT(*) FROM WMS_C_PLANT_BUSINESS WHERE WERKS = RH.WERKS AND BUSINESS_CODE IN 
	(SELECT BUSINESS_CODE FROM WMS_C_WMS_BUSINESS WHERE BUSINESS_CLASS = '06')) PC_COUNT,
	(SELECT NVL(SUM(I.QTY_REAL),0) AS TL_QTY FROM WMS_OUT_REQUIREMENT_ITEM I
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD H ON I.REQUIREMENT_NO = H.REQUIREMENT_NO WHERE
	H.WERKS = #{WERKS} AND H.WH_NUMBER = #{WH_NUMBER} AND I.IO_NO = #{IN_ORDER} AND I.MATNR = RI.MATNR
	) TL_QTY,
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE IO_NO = #{IN_ORDER} AND MATNR = RI.MATNR
	AND ITEM_STATUS='00' AND DEL = '0'
	),0) RETURN_QTY, --已创单数量
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE IO_NO = #{IN_ORDER} AND MATNR = RI.MATNR
	AND ITEM_STATUS='02' AND DEL = '0'
	),0) FINISH_QTY, --已交接数量
	(SELECT NVL(SUM(WI.QTY_CANCEL),0) FROM WMS_CORE_WMSDOC_ITEM WI WHERE 
	WI.RETURN_NO = RE_I.RETURN_NO AND WI.RETURN_ITEM_NO = RE_I.RETURN_ITEM_NO
	) QX_QTY 		--取消/冲销数量
	FROM WMS_OUT_REQUIREMENT_ITEM RI 
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD RH ON RI.REQUIREMENT_NO = RH.REQUIREMENT_NO	
	LEFT JOIN WMS_OUT_RETURN_ITEM RE_I ON RE_I.MO_NO = RI.MO_NO AND RE_I.MO_ITEM_NO = RI.MO_ITEM_NO
	WHERE RH.WERKS = #{WERKS} AND RH.WH_NUMBER = #{WH_NUMBER} AND RI.BUSINESS_NAME = '43' AND RI.BUSINESS_TYPE = '13'
	AND RI.REQ_ITEM_STATUS IN ('04','05','06') AND RI.IO_NO = #{IN_ORDER} 
	<if test="MATNRS !=null and MATNRS !=''">
	AND RI.MATNR IN ${MATNRS} 
	</if>
	</select>
	<select id="getWorkshopReturnData38" parameterType="Map" resultType="Map">
	SELECT DISTINCT RI.MATNR,RI.MAKTX,RI.UNIT AS MEINS,RI.LGORT,RI.SOBKZ,
	' ' AS REASON ,' ' AS SQE,RI.COST_CENTER,
	(SELECT COUNT(*) FROM WMS_C_PLANT_BUSINESS WHERE WERKS = RH.WERKS AND BUSINESS_CODE IN 
	(SELECT BUSINESS_CODE FROM WMS_C_WMS_BUSINESS WHERE BUSINESS_CLASS = '06')) PC_COUNT,
	(SELECT NVL(SUM(I.QTY_REAL),0) AS TL_QTY FROM WMS_OUT_REQUIREMENT_ITEM I
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD H ON I.REQUIREMENT_NO = H.REQUIREMENT_NO WHERE
	H.WERKS = #{WERKS} AND H.WH_NUMBER = #{WH_NUMBER} AND I.COST_CENTER = #{COSTCENTER} AND I.MATNR = RI.MATNR
	) TL_QTY,
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE COST_CENTER = #{COSTCENTER} AND MATNR = RI.MATNR
	AND ITEM_STATUS='00' AND DEL = '0'
	),0) RETURN_QTY, --已创单数量
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE COST_CENTER = #{COSTCENTER} AND MATNR = RI.MATNR
	AND ITEM_STATUS='02' AND DEL = '0'
	),0) FINISH_QTY, --已交接数量
	(SELECT NVL(SUM(WI.QTY_CANCEL),0) FROM WMS_CORE_WMSDOC_ITEM WI WHERE 
	WI.RETURN_NO = RE_I.RETURN_NO AND WI.RETURN_ITEM_NO = RE_I.RETURN_ITEM_NO
	) QX_QTY 		--取消/冲销数量
	FROM WMS_OUT_REQUIREMENT_ITEM RI 
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD RH ON RI.REQUIREMENT_NO = RH.REQUIREMENT_NO	
	LEFT JOIN WMS_OUT_RETURN_ITEM RE_I ON RE_I.MO_NO = RI.MO_NO AND RE_I.MO_ITEM_NO = RI.MO_ITEM_NO
	WHERE RH.WERKS = #{WERKS} AND RH.WH_NUMBER = #{WH_NUMBER} AND RI.BUSINESS_NAME = '44' AND RI.BUSINESS_TYPE = '14'
	AND RI.REQ_ITEM_STATUS IN ('04','05','06') AND RI.COST_CENTER = #{COSTCENTER} 
	<if test="MATNRS !=null and MATNRS !=''">
	AND RI.MATNR IN ${MATNRS} 
	</if>
	</select>
	<select id="getWorkshopReturnData39" parameterType="Map" resultType="Map">
	SELECT DISTINCT RI.MATNR,RI.MAKTX,RI.UNIT AS MEINS,RI.LGORT,RI.SOBKZ,
	' ' AS REASON ,' ' AS SQE,
	(SELECT COUNT(*) FROM WMS_C_PLANT_BUSINESS WHERE WERKS = RH.WERKS AND BUSINESS_CODE IN 
	(SELECT BUSINESS_CODE FROM WMS_C_WMS_BUSINESS WHERE BUSINESS_CLASS = '06')) PC_COUNT,
	(SELECT NVL(SUM(I.QTY_REAL),0) AS TL_QTY FROM WMS_OUT_REQUIREMENT_ITEM I
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD H ON I.REQUIREMENT_NO = H.REQUIREMENT_NO WHERE
	H.WERKS = #{WERKS} AND H.WH_NUMBER = #{WH_NUMBER} AND I.WBS = #{WBS} AND I.MATNR = RI.MATNR
	) TL_QTY,
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE WBS = #{WBS} AND MATNR = RI.MATNR
	AND ITEM_STATUS='00' AND DEL = '0'
	),0) RETURN_QTY, --已创单数量
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE WBS = #{WBS} AND MATNR = RI.MATNR
	AND ITEM_STATUS='02' AND DEL = '0'
	),0) FINISH_QTY, --已交接数量
	(SELECT NVL(SUM(WI.QTY_CANCEL),0) FROM WMS_CORE_WMSDOC_ITEM WI WHERE 
	WI.RETURN_NO = RE_I.RETURN_NO AND WI.RETURN_ITEM_NO = RE_I.RETURN_ITEM_NO
	) QX_QTY 		--取消/冲销数量
	FROM WMS_OUT_REQUIREMENT_ITEM RI 
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD RH ON RI.REQUIREMENT_NO = RH.REQUIREMENT_NO	
	LEFT JOIN WMS_OUT_RETURN_ITEM RE_I ON RE_I.MO_NO = RI.MO_NO AND RE_I.MO_ITEM_NO = RI.MO_ITEM_NO
	WHERE RH.WERKS = #{WERKS} AND RH.WH_NUMBER = #{WH_NUMBER} AND RI.BUSINESS_NAME = '45' AND RI.BUSINESS_TYPE = '15'
	AND RI.REQ_ITEM_STATUS IN ('04','05','06') AND RI.WBS = #{WBS} 
	<if test="MATNRS !=null and MATNRS !=''">
	AND RI.MATNR IN ${MATNRS} 
	</if>
	</select>
	<select id="getWorkshopReturnData40" parameterType="Map" resultType="Map">
	SELECT RI.REQUIREMENT_NO,RI.REQUIREMENT_ITEM_NO,RI.MATNR,RI.MAKTX,RI.UNIT AS MEINS,RI.LGORT,RI.SOBKZ,
	' ' AS REASON ,' ' AS SQE,
	(SELECT COUNT(*) FROM WMS_C_PLANT_BUSINESS WHERE WERKS = RH.WERKS AND BUSINESS_CODE IN 
	(SELECT BUSINESS_CODE FROM WMS_C_WMS_BUSINESS WHERE BUSINESS_CLASS = '06')) PC_COUNT,
	(SELECT NVL(SUM(I.QTY_REAL),0) AS TL_QTY FROM WMS_OUT_REQUIREMENT_ITEM I
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD H ON I.REQUIREMENT_NO = H.REQUIREMENT_NO WHERE
	H.WERKS = #{WERKS} AND H.WH_NUMBER = #{WH_NUMBER} AND NVL(I.MO_NO,'0') = NVL(RI.MO_NO,'0') 
	AND I.REQUIREMENT_NO = RI.REQUIREMENT_NO AND I.REQUIREMENT_ITEM_NO = RI.REQUIREMENT_ITEM_NO AND I.MATNR = RI.MATNR
	) TL_QTY,
	NVL((SELECT SUM(T.TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM T
	LEFT JOIN WMS_OUT_RETURN_ITEM_D TD ON T.RETURN_NO = TD.RETURN_NO AND T.RETURN_ITEM_NO = TD.RETURN_ITEM_NO
	WHERE NVL(T.MO_NO,'0') = NVL(RI.MO_NO,'0')  AND T.MATNR = RI.MATNR
	AND T.REQUIREMENT_NO = RI.REQUIREMENT_NO 
    AND (T.REQUIREMENT_ITEM_NO = RI.REQUIREMENT_ITEM_NO OR T.REQUIREMENT_ITEM_NO IS NULL)
    AND T.ITEM_STATUS = '00' AND T.DEL = '0'
    AND NVL(TD.LGORT,'0') = NVL(RI.LGORT,'0') 
	),0) RETURN_QTY, --已创单数量
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE NVL(MO_NO,'0') = NVL(RI.MO_NO,'0') AND MATNR = RI.MATNR
	AND REQUIREMENT_NO = RI.REQUIREMENT_NO 
	AND (REQUIREMENT_ITEM_NO = RI.REQUIREMENT_ITEM_NO OR REQUIREMENT_ITEM_NO IS NULL)
	AND ITEM_STATUS='03' AND DEL = '0' AND NVL(LGORT,'0') = NVL(RI.LGORT,'0')
	),0) FINISH_QTY, --已交接数量
	(SELECT NVL(SUM(WI.QTY_CANCEL),0) FROM WMS_CORE_WMSDOC_ITEM WI WHERE 
	WI.RETURN_NO = RE_I.RETURN_NO AND WI.RETURN_ITEM_NO = RE_I.RETURN_ITEM_NO
	) QX_QTY 		--取消/冲销数量
	FROM WMS_OUT_REQUIREMENT_ITEM RI 
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD RH ON RI.REQUIREMENT_NO = RH.REQUIREMENT_NO	
	LEFT JOIN WMS_OUT_RETURN_ITEM RE_I ON RE_I.MO_NO = RI.MO_NO AND RE_I.MO_ITEM_NO = RI.MO_ITEM_NO
	WHERE RH.WERKS = #{WERKS} AND RH.WH_NUMBER = #{WH_NUMBER} AND RI.BUSINESS_NAME = '48' AND RI.BUSINESS_TYPE = '00'
	AND RI.REQ_ITEM_STATUS IN ('04','05','06') AND RI.RECEIVE_LGORT = #{LGORT}
	<if test="AUFNRS !=null and AUFNRS !=''">
	AND RI.MO_NO IN ${AUFNRS} 
	</if>
	<if test="MATNRS !=null and MATNRS !=''">
	AND RI.MATNR IN ${MATNRS} 
	</if>
	</select>
	<select id="getWorkshopReturnData68" parameterType="Map" resultType="Map">
	SELECT RI.PO_NO RSNUM,RI.PO_ITEM_NO RSPOS, RI.REQUIREMENT_NO,RI.REQUIREMENT_ITEM_NO,RI.MATNR,RI.MAKTX,RI.UNIT AS MEINS,RI.LGORT,RI.SOBKZ,
	' ' AS REASON ,' ' AS SQE,
	(SELECT COUNT(*) FROM WMS_C_PLANT_BUSINESS WHERE WERKS = RH.WERKS AND BUSINESS_CODE IN 
	(SELECT BUSINESS_CODE FROM WMS_C_WMS_BUSINESS WHERE BUSINESS_CLASS = '06')) PC_COUNT,
	(SELECT NVL(SUM(I.QTY_REAL),0) AS TL_QTY FROM WMS_OUT_REQUIREMENT_ITEM I
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD H ON I.REQUIREMENT_NO = H.REQUIREMENT_NO WHERE
	H.WERKS = #{WERKS} AND H.WH_NUMBER = #{WH_NUMBER} 
	<if test="LIFNR !=null and LIFNR !=''">
	AND I.LIFNR = #{LIFNR} 
	</if>
	AND I.MATNR = RI.MATNR
	) TL_QTY,
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE PO_NO = RI.PO_NO AND MATNR = RI.MATNR
	AND ITEM_STATUS='00' AND DEL = '0'
	),0) RETURN_QTY, --已创单数量
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE PO_NO = RI.PO_NO AND MATNR = RI.MATNR
	AND ITEM_STATUS='02' AND DEL = '0'
	),0) FINISH_QTY, --已交接数量
	(SELECT NVL(SUM(WI.QTY_CANCEL),0) FROM WMS_CORE_WMSDOC_ITEM WI WHERE 
	WI.RETURN_NO = RE_I.RETURN_NO AND WI.RETURN_ITEM_NO = RE_I.RETURN_ITEM_NO
	) QX_QTY 		--取消/冲销数量
	FROM WMS_OUT_REQUIREMENT_ITEM RI 
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD RH ON RI.REQUIREMENT_NO = RH.REQUIREMENT_NO	
	LEFT JOIN WMS_OUT_RETURN_ITEM RE_I ON RE_I.MO_NO = RI.MO_NO AND RE_I.MO_ITEM_NO = RI.MO_ITEM_NO
	WHERE RH.WERKS = #{WERKS} AND RH.WH_NUMBER = #{WH_NUMBER} AND RI.BUSINESS_NAME = '64' AND RI.BUSINESS_TYPE = '02'
	AND RI.REQ_ITEM_STATUS IN ('04','05','06') 
	<if test="POORDERS !=null and POORDERS !=''">
	AND RI.PO_NO IN ${POORDERS} 
	</if>
	<if test="MATNRS !=null and MATNRS !=''">
	AND C.MATNR IN ${MATNRS} 
	</if>
	</select>
	<select id="getWorkshopReturnData69" parameterType="Map" resultType="Map">
	SELECT RI.PO_NO RSNUM,RI.PO_ITEM_NO RSPOS,RI.REQUIREMENT_NO,RI.REQUIREMENT_ITEM_NO,RI.MATNR,RI.MAKTX,RI.UNIT AS MEINS,RI.LGORT,RI.SOBKZ,
	' ' AS REASON ,' ' AS SQE,#{LIFNR} AS LIFNR,
	(SELECT COUNT(*) FROM WMS_C_PLANT_BUSINESS WHERE WERKS = RH.WERKS AND BUSINESS_CODE IN 
	(SELECT BUSINESS_CODE FROM WMS_C_WMS_BUSINESS WHERE BUSINESS_CLASS = '06')) PC_COUNT,
	(SELECT NVL(SUM(I.QTY_REAL),0) AS TL_QTY FROM WMS_OUT_REQUIREMENT_ITEM I
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD H ON I.REQUIREMENT_NO = H.REQUIREMENT_NO WHERE
	H.WERKS = #{WERKS} AND H.WH_NUMBER = #{WH_NUMBER} AND I.CUSTOMER = #{LIFNR} AND I.MATNR = RI.MATNR
	) TL_QTY,
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE LIFNR = #{LIFNR} AND MATNR = RI.MATNR
	AND ITEM_STATUS='00' AND DEL = '0'
	),0) RETURN_QTY, --已创单数量
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE LIFNR = #{LIFNR} AND MATNR = RI.MATNR
	AND ITEM_STATUS='02' AND DEL = '0'
	),0) FINISH_QTY, --已交接数量
	(SELECT NVL(SUM(WI.QTY_CANCEL),0) FROM WMS_CORE_WMSDOC_ITEM WI WHERE 
	WI.RETURN_NO = RE_I.RETURN_NO AND WI.RETURN_ITEM_NO = RE_I.RETURN_ITEM_NO
	) QX_QTY 		--取消/冲销数量
	FROM WMS_OUT_REQUIREMENT_ITEM RI 
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD RH ON RI.REQUIREMENT_NO = RH.REQUIREMENT_NO	
	LEFT JOIN WMS_OUT_RETURN_ITEM RE_I ON RE_I.MO_NO = RI.MO_NO AND RE_I.MO_ITEM_NO = RI.MO_ITEM_NO
	WHERE RH.WERKS = #{WERKS} AND RH.WH_NUMBER = #{WH_NUMBER} AND RI.BUSINESS_NAME = '49' AND RI.BUSINESS_TYPE = '02'
	AND RI.REQ_ITEM_STATUS IN ('04','05','06') AND RI.CUSTOMER = #{LIFNR} 
	<if test="POORDERS !=null and POORDERS !=''">
	AND RI.PO_NO IN ${POORDERS} 
	</if>
	<if test="MATNRS !=null and MATNRS !=''">
	AND C.MATNR IN ${MATNRS} 
	</if>
	</select>
	<select id="getWorkshopReturnData46" parameterType="Map" resultType="Map">
	SELECT RI.REQUIREMENT_NO,RI.REQUIREMENT_ITEM_NO,RI.MATNR,RI.MAKTX,RI.UNIT AS MEINS,RI.LGORT,RI.SOBKZ,
	' ' AS REASON ,' ' AS SQE,
	(SELECT COUNT(*) FROM WMS_C_PLANT_BUSINESS WHERE WERKS = RH.WERKS AND BUSINESS_CODE IN 
	(SELECT BUSINESS_CODE FROM WMS_C_WMS_BUSINESS WHERE BUSINESS_CLASS = '06')) PC_COUNT,
	(SELECT NVL(SUM(I.QTY_REAL),0) AS TL_QTY FROM WMS_OUT_REQUIREMENT_ITEM I
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD H ON I.REQUIREMENT_NO = H.REQUIREMENT_NO WHERE
	H.WERKS = #{WERKS} AND H.WH_NUMBER = #{WH_NUMBER} 
	<if test="LIFNR !=null and LIFNR !=''">
	AND I.LIFNR = #{LIFNR} 
	</if>
	AND I.MATNR = RI.MATNR AND I.DEL != 'X'
	AND I.BUSINESS_NAME = '46' AND I.BUSINESS_TYPE = '00' AND I.REQ_ITEM_STATUS IN ('04','05','06') 
	) TL_QTY,
	NVL((SELECT SUM(WRI.TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WRI
	LEFT JOIN WMS_OUT_RETURN_HEAD WRH ON WRI.RETURN_NO = WRH.RETURN_NO
	WHERE WRH.F_WERKS = #{F_WERKS} 
	<if test="LIFNR !=null and LIFNR !=''">
	AND WRI.LIFNR = #{LIFNR} 
	</if>
	AND WRI.MATNR = RI.MATNR
	AND WRI.ITEM_STATUS='00' AND WRI.DEL = '0'
	),0) RETURN_QTY, --已创单数量 
	NVL((SELECT SUM(WRI.TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WRI 
	LEFT JOIN WMS_OUT_RETURN_HEAD WRH ON WRI.RETURN_NO = WRH.RETURN_NO
	WHERE WRH.F_WERKS = #{F_WERKS} 
	<if test="LIFNR !=null and LIFNR !=''">
	AND WRI.LIFNR = #{LIFNR} 
	</if>
	AND WRI.MATNR = RI.MATNR
	AND WRI.ITEM_STATUS='02' AND WRI.DEL = '0'
	),0) FINISH_QTY, --已交接数量
	(SELECT NVL(SUM(WI.QTY_CANCEL),0) FROM WMS_CORE_WMSDOC_ITEM WI WHERE WI.F_WERKS = #{F_WERKS} AND
	WI.RETURN_NO = RE_I.RETURN_NO AND WI.RETURN_ITEM_NO = RE_I.RETURN_ITEM_NO
	) QX_QTY 		 --取消/冲销数量
	FROM WMS_OUT_REQUIREMENT_ITEM RI 
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD RH ON RI.REQUIREMENT_NO = RH.REQUIREMENT_NO	
	LEFT JOIN WMS_OUT_RETURN_ITEM RE_I ON RE_I.MO_NO = RI.MO_NO AND RE_I.MO_ITEM_NO = RI.MO_ITEM_NO
	WHERE RH.WERKS = #{WERKS} AND RH.WH_NUMBER = #{WH_NUMBER} AND RI.BUSINESS_NAME = '46' AND RI.BUSINESS_TYPE = '00'
	AND RI.REQ_ITEM_STATUS IN ('04','05','06') AND RH.RECEIVE_WERKS = #{F_WERKS} 
	<if test="MATNRS !=null and MATNRS !=''">
	AND C.MATNR IN ${MATNRS} 
	</if>
	</select>
	<select id="getWorkshopReturnData70" parameterType="Map" resultType="Map">
	-- 190712 数量不再关联供应商字段(D)
	SELECT RI.LIFNR,RI.REQUIREMENT_NO,RI.REQUIREMENT_ITEM_NO,RI.MATNR,RI.MAKTX,RI.UNIT AS MEINS,RI.LGORT,RI.SOBKZ,
	' ' AS REASON ,' ' AS SQE,RI.SAP_OUT_NO,RI.SAP_OUT_ITEM_NO,
	(SELECT COUNT(*) FROM WMS_C_PLANT_BUSINESS WHERE WERKS = RH.WERKS AND BUSINESS_CODE IN 
	(SELECT BUSINESS_CODE FROM WMS_C_WMS_BUSINESS WHERE BUSINESS_CLASS = '06')) PC_COUNT,
	(SELECT NVL(SUM(I.QTY_REAL),0) AS TL_QTY FROM WMS_OUT_REQUIREMENT_ITEM I
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD H ON I.REQUIREMENT_NO = H.REQUIREMENT_NO WHERE
	H.WERKS = #{WERKS} AND H.WH_NUMBER = #{WH_NUMBER} AND I.MATNR = RI.MATNR
	) TL_QTY,
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE MATNR = RI.MATNR
	AND ITEM_STATUS='00' AND DEL = '0' 
	),0) RETURN_QTY, --已创单数量
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE MATNR = RI.MATNR
	AND ITEM_STATUS='02' AND DEL = '0' 
	),0) FINISH_QTY, --已交接数量
	(SELECT NVL(SUM(WI.QTY_CANCEL),0) FROM WMS_CORE_WMSDOC_ITEM WI WHERE 
	WI.RETURN_NO = RE_I.RETURN_NO AND WI.RETURN_ITEM_NO = RE_I.RETURN_ITEM_NO
	) QX_QTY 		--取消/冲销数量
	FROM WMS_OUT_REQUIREMENT_ITEM RI 
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD RH ON RI.REQUIREMENT_NO = RH.REQUIREMENT_NO	
	LEFT JOIN WMS_OUT_RETURN_ITEM RE_I ON RE_I.MO_NO = RI.MO_NO AND RE_I.MO_ITEM_NO = RI.MO_ITEM_NO
	WHERE RH.WERKS = #{WERKS} AND RH.WH_NUMBER = #{WH_NUMBER} AND RI.BUSINESS_NAME = '50' AND RI.BUSINESS_TYPE = '06'
	AND RI.REQ_ITEM_STATUS IN ('04','05','06')
	<if test="SAP_ORDERS !=null and SAP_ORDERS !=''">
	AND RI.SAP_OUT_NO IN ${SAP_ORDERS} 
	</if>
	<if test="MATNRS !=null and MATNRS !=''">
	AND C.MATNR IN ${MATNRS} 
	</if>
	</select>
	<select id="getWorkshopReturnData71" parameterType="Map" resultType="Map">
	SELECT RI.LIFNR,RI.REQUIREMENT_NO,RI.REQUIREMENT_ITEM_NO,RI.MATNR,RI.MAKTX,RI.UNIT AS MEINS,RI.LGORT,RI.SOBKZ,
	' ' AS REASON ,' ' AS SQE,RI.SAP_OUT_NO,RI.SAP_OUT_ITEM_NO,
	(SELECT COUNT(*) FROM WMS_C_PLANT_BUSINESS WHERE WERKS = RH.WERKS AND BUSINESS_CODE IN 
	(SELECT BUSINESS_CODE FROM WMS_C_WMS_BUSINESS WHERE BUSINESS_CLASS = '06')) PC_COUNT,
	(SELECT NVL(SUM(I.QTY_REAL),0) AS TL_QTY FROM WMS_OUT_REQUIREMENT_ITEM I
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD H ON I.REQUIREMENT_NO = H.REQUIREMENT_NO WHERE
	H.WERKS = #{WERKS} AND H.WH_NUMBER = #{WH_NUMBER} AND I.LIFNR = RI.LIFNR AND I.MATNR = RI.MATNR
	) TL_QTY,
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE LIFNR = RI.LIFNR AND MATNR = RI.MATNR
	AND ITEM_STATUS='00' AND DEL = '0' AND LGORT = RI.LGORT
	),0) RETURN_QTY, --已创单数量
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE LIFNR = RI.LIFNR AND MATNR = RI.MATNR
	AND ITEM_STATUS='02' AND DEL = '0' AND LGORT = RI.LGORT
	),0) FINISH_QTY, --已交接数量
	(SELECT NVL(SUM(WI.QTY_CANCEL),0) FROM WMS_CORE_WMSDOC_ITEM WI WHERE 
	WI.RETURN_NO = RE_I.RETURN_NO AND WI.RETURN_ITEM_NO = RE_I.RETURN_ITEM_NO
	) QX_QTY 		--取消/冲销数量
	FROM WMS_OUT_REQUIREMENT_ITEM RI 
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD RH ON RI.REQUIREMENT_NO = RH.REQUIREMENT_NO	
	LEFT JOIN WMS_OUT_RETURN_ITEM RE_I ON RE_I.MO_NO = RI.MO_NO AND RE_I.MO_ITEM_NO = RI.MO_ITEM_NO
	WHERE RH.WERKS = #{WERKS} AND RH.WH_NUMBER = #{WH_NUMBER} AND RI.BUSINESS_NAME = '51' AND RI.BUSINESS_TYPE = '16'
	AND RI.REQ_ITEM_STATUS IN ('04','05','06')
	<if test="SAP_ORDERS !=null and SAP_ORDERS !=''">
	AND RI.SAP_OUT_NO IN ${SAP_ORDERS} 
	</if>
	<if test="MATNRS !=null and MATNRS !=''">
	AND C.MATNR IN ${MATNRS} 
	</if>
	</select>
	<select id="getWorkshopReturnData72" parameterType="Map" resultType="Map">
	SELECT RI.REQUIREMENT_NO,RI.REQUIREMENT_ITEM_NO,RI.MATNR,RI.MAKTX,RI.UNIT AS MEINS,RI.LGORT,RI.SOBKZ,
	' ' AS REASON ,' ' AS SQE,
	(SELECT COUNT(*) FROM WMS_C_PLANT_BUSINESS WHERE WERKS = RH.WERKS AND BUSINESS_CODE IN 
	(SELECT BUSINESS_CODE FROM WMS_C_WMS_BUSINESS WHERE BUSINESS_CLASS = '06')) PC_COUNT,
	(SELECT NVL(SUM(I.QTY_REAL),0) AS TL_QTY FROM WMS_OUT_REQUIREMENT_ITEM I
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD H ON I.REQUIREMENT_NO = H.REQUIREMENT_NO WHERE
	H.WERKS = #{WERKS} AND H.WH_NUMBER = #{WH_NUMBER} AND I.PO_NO = RI.PO_NO AND I.MATNR = RI.MATNR
	) TL_QTY,
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE PO_NO = RI.PO_NO AND MATNR = RI.MATNR
	AND ITEM_STATUS='00' AND DEL = '0' AND LGORT = RI.LGORT
	),0) RETURN_QTY, --已创单数量
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE PO_NO = RI.PO_NO AND MATNR = RI.MATNR
	AND ITEM_STATUS='02' AND DEL = '0' AND LGORT = RI.LGORT
	),0) FINISH_QTY, --已交接数量
	(SELECT NVL(SUM(WI.QTY_CANCEL),0) FROM WMS_CORE_WMSDOC_ITEM WI WHERE 
	WI.RETURN_NO = RE_I.RETURN_NO AND WI.RETURN_ITEM_NO = RE_I.RETURN_ITEM_NO
	) QX_QTY 		--取消/冲销数量
	FROM WMS_OUT_REQUIREMENT_ITEM RI 
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD RH ON RI.REQUIREMENT_NO = RH.REQUIREMENT_NO	
	LEFT JOIN WMS_OUT_RETURN_ITEM RE_I ON RE_I.MO_NO = RI.MO_NO AND RE_I.MO_ITEM_NO = RI.MO_ITEM_NO
	WHERE RH.WERKS = #{WERKS} AND RH.WH_NUMBER = #{WH_NUMBER} AND RI.BUSINESS_NAME = '52' AND RI.BUSINESS_TYPE = '00'
	AND RI.REQ_ITEM_STATUS IN ('04','05','06')
	<if test="PO_ORDER !=null and PO_ORDER !=''">
	AND RI.PO_NO IN ${PO_ORDER} 
	</if>
	<if test="MATNRS !=null and MATNRS !=''">
	AND C.MATNR IN ${MATNRS} 
	</if>
	</select>
	
	<select id="getSapWmsMoveType" parameterType="Map" resultType="Map">
	SELECT SAP_MOVE_TYPE,WMS_MOVE_TYPE FROM WMS_C_WMS_BUSINESS WHERE BUSINESS_NAME = #{BUSINESS_NAME} 
	AND BUSINESS_TYPE = #{BUSINESS_TYPE}  AND SOBKZ = #{SOBKZ} 
	</select>
	
	<select id="getWorkshopReturnMatInfoList" parameterType="Map" resultType="Map">
	SELECT H.WERKS,H.F_WERKS,H.WH_NUMBER,I.RETURN_ITEM_NO,I.MATNR,I.MO_NO,I.MO_ITEM_NO,I.WBS,I.COST_CENTER,I.IO_NO,I.F_LGORT LGORT,
	I.LIFNR,I.SAP_OUT_NO,I.SAP_OUT_ITEM_NO,I.PO_NO,I.PO_ITEM_NO,I.RSNUM,I.RSPOS,I.BUSINESS_NAME,I.BUSINESS_TYPE,I.TOTAL_RETURN_QTY,I.REQUIREMENT_NO,I.REQUIREMENT_ITEM_NO 
	FROM WMS_OUT_RETURN_HEAD H 
	LEFT JOIN WMS_OUT_RETURN_ITEM I ON H.RETURN_NO = I.RETURN_NO
	WHERE H.RETURN_NO = #{RETURN_NO}
	</select>
	<select id="getWorkshopReturnPickingData" parameterType="Map" resultType="Map">
	SELECT (SELECT ID FROM WMS_OUT_RETURN_HEAD WHERE RETURN_NO = #{RETURN_NO}) HID,
	(SELECT ID FROM WMS_OUT_RETURN_ITEM WHERE RETURN_NO = #{RETURN_NO} AND RETURN_ITEM_NO = #{RETURN_ITEM_NO}) IID,
	P.ID PID,P.WERKS,P.WH_NUMBER,#{RETURN_NO} AS RETURN_NO,
	(SELECT RETURN_TYPE FROM WMS_OUT_RETURN_HEAD WHERE RETURN_NO = #{RETURN_NO}) RETURN_TYPE,
	(SELECT RETURN_STATUS FROM WMS_OUT_RETURN_HEAD WHERE RETURN_NO = #{RETURN_NO}) RETURN_STATUS,
	#{RETURN_ITEM_NO} AS RETURN_ITEM_NO,#{TOTAL_RETURN_QTY} AS TOTAL_RETURN_QTY,
	P.MATNR,P.MAKTX,P.UNIT,H.REQUIREMENT_NO,P.LGORT,P.BATCH,T.HANDOVER_TYPE,
	#{WBS} WBS,#{MO_NO} MO_NO,#{MO_ITEM_NO} MO_ITEM_NO,#{IO_NO} IO_NO,#{COST_CENTER} COST_CENTER,
	#{LGORT} F_LGORT,#{PO_NO} PO_NO,#{PO_ITEM_NO} PO_ITEM_NO,
	(I.QTY_REAL - 
	(SELECT NVL(SUM(ID.RETURN_QTY),0) FROM WMS_OUT_RETURN_ITEM_D ID 
	LEFT JOIN WMS_OUT_RETURN_ITEM II ON ID.RETURN_NO = II.RETURN_NO AND ID.RETURN_ITEM_NO = II.RETURN_ITEM_NO
	WHERE ID.BATCH = P.BATCH  AND ID.DEL != 'X' 
	<if test="BUSINESS_NAME == '35'">
	AND II.MO_NO = #{MO_NO} AND II.MO_ITEM_NO = #{MO_ITEM_NO} 
	</if>
	<if test="BUSINESS_NAME == '36'">
	AND II.MO_NO = #{MO_NO} 
	</if>
	<if test="BUSINESS_NAME == '37'">
	AND II.IO_NO = #{IO_NO}
	</if>
	<if test="BUSINESS_NAME == '38'">
	AND II.COST_CENTER = #{COST_CENTER}
	</if>
	<if test="BUSINESS_NAME == '39'">
	AND II.WBS = #{WBS}
	</if>
	<if test="BUSINESS_NAME == '40'">
	AND II.F_LGORT = #{LGORT}
	</if>
	<if test="BUSINESS_NAME == '69'">
	AND II.PO_NO = #{PO_NO}
	</if>
	<if test="BUSINESS_NAME == '68'">
	AND II.PO_NO = #{RSNUM} AND II.PO_ITEM_NO = #{RSPOS} 
	</if>
	<if test="BUSINESS_NAME == '72'">
	AND II.PO_NO = #{PO_NO} AND II.PO_ITEM_NO = #{PO_ITEM_NO} 
	</if>
	) 
	) RETURN_QTY,
	NVL(P.LIFNR,' ') LIFNR,NVL(V.NAME1,' ') LIKTX,P.SOBKZ,P.BATCH,P.CREATE_DATE,B.WMS_MOVE_TYPE,B.SAP_MOVE_TYPE,P.FROM_BIN_CODE BIN_CODE,
	#{BUSINESS_NAME} BUSINESS_NAME,I.BUSINESS_TYPE,
	(SELECT BUSINESS_CLASS FROM WMS_C_WMS_BUSINESS WHERE BUSINESS_NAME = #{BUSINESS_NAME} AND ROWNUM = 1)
	BUSINESS_CLASS,I.MO_NO,I.MO_ITEM_NO,
	<if test="BUSINESS_NAME == '68'">
	#{RSNUM} RSNUM,#{RSPOS} RSPOS
	</if>
	<if test="BUSINESS_NAME != '68'">
	I.RSNUM,I.RSPOS
	</if>
	
	FROM WMS_OUT_REQUIREMENT_HEAD H 
	LEFT JOIN WMS_OUT_REQUIREMENT_ITEM I ON H.REQUIREMENT_NO = I.REQUIREMENT_NO
	LEFT JOIN WMS_OUT_PICKING P ON P.REFERENCE_DELIVERY_NO = I.REQUIREMENT_NO AND P.REFERENCE_DELIVERY_ITEM = I.REQUIREMENT_ITEM_NO
	LEFT JOIN WMS_SAP_VENDOR V ON P.LIFNR = V.LIFNR
	LEFT JOIN WMS_C_WMS_BUSINESS B ON #{BUSINESS_NAME} = B.BUSINESS_NAME AND I.BUSINESS_TYPE = B.BUSINESS_TYPE AND B.SOBKZ = #{SOBKZ}
	LEFT JOIN WMS_C_HANDOVER_TYPE T ON T.WERKS = H.WERKS AND T.WH_NUMBER = H.WH_NUMBER AND 
	T.BUSINESS_NAME = #{BUSINESS_NAME} AND T.DEL = '0'
	WHERE H.WERKS = #{WERKS} AND H.WH_NUMBER = #{WH_NUMBER} AND I.REQ_ITEM_STATUS IN ('04','05','06') AND I.DEL != 'X'
	AND P.MATNR = #{MATNR} 
	<if test="REQUIREMENT_NO !=null and REQUIREMENT_NO !=''">
	AND H.REQUIREMENT_NO = #{REQUIREMENT_NO} 
	</if>
	<if test="REQUIREMENT_ITEM_NO !=null and REQUIREMENT_ITEM_NO !=''">
	AND I.REQUIREMENT_ITEM_NO = #{REQUIREMENT_ITEM_NO} 
	</if>
	<if test="BUSINESS_NAME == '35'">
	AND I.MO_NO = #{MO_NO} AND I.MO_ITEM_NO = #{MO_ITEM_NO} 
	</if>
	<if test="BUSINESS_NAME == '36'">
	AND I.MO_NO = #{MO_NO} 
	</if>
	<if test="BUSINESS_NAME == '37'">
	AND I.IO_NO = #{IO_NO}
	</if>
	<if test="BUSINESS_NAME == '38'">
	AND I.COST_CENTER = #{COST_CENTER}
	</if>
	<if test="BUSINESS_NAME == '39'">
	AND I.WBS = #{WBS}
	</if>
	<if test="BUSINESS_NAME == '40'">
	AND I.RECEIVE_LGORT = #{LGORT}
	</if>
	<if test="BUSINESS_NAME == '69'">
	AND I.PO_NO = #{PO_NO}
	</if>
	<if test="BUSINESS_NAME == '68'">
	AND I.PO_NO = #{RSNUM} AND I.PO_ITEM_NO = #{RSPOS} 
	</if>
	<if test="BUSINESS_NAME == '72'">
	AND I.PO_NO = #{PO_NO} AND I.PO_ITEM_NO = #{PO_ITEM_NO} 
	</if>
	AND I.BUSINESS_TYPE = #{BUSINESS_TYPE}
	AND (I.QTY_REAL - 
	(SELECT NVL(SUM(ID.RETURN_QTY),0) FROM WMS_OUT_RETURN_ITEM_D ID 
	LEFT JOIN WMS_OUT_RETURN_ITEM II ON ID.RETURN_NO = II.RETURN_NO AND ID.RETURN_ITEM_NO = II.RETURN_ITEM_NO
	WHERE ID.BATCH = P.BATCH  AND ID.DEL != 'X' 
	<if test="BUSINESS_NAME == '35'">
	AND II.MO_NO = #{MO_NO} AND II.MO_ITEM_NO = #{MO_ITEM_NO} 
	</if>
	<if test="BUSINESS_NAME == '36'">
	AND II.MO_NO = #{MO_NO} 
	</if>
	<if test="BUSINESS_NAME == '37'">
	AND II.IO_NO = #{IO_NO}
	</if>
	<if test="BUSINESS_NAME == '38'">
	AND II.COST_CENTER = #{COST_CENTER}
	</if>
	<if test="BUSINESS_NAME == '39'">
	AND II.WBS = #{WBS}
	</if>
	<if test="BUSINESS_NAME == '40'">
	AND II.F_LGORT = #{LGORT}
	</if>
	<if test="BUSINESS_NAME == '69'">
	AND II.PO_NO = #{PO_NO}
	</if>
	<if test="BUSINESS_NAME == '68'">
	AND II.PO_NO = #{RSNUM} AND II.PO_ITEM_NO = #{RSPOS} 
	</if>
	<if test="BUSINESS_NAME == '72'">
	AND II.PO_NO = #{PO_NO} AND II.PO_ITEM_NO = #{PO_ITEM_NO} 
	</if>
	) 
	) >0 
	ORDER BY P.BATCH,SOBKZ,P.CREATE_DATE
	</select>
	
	<insert id="insertCoreLabel" parameterType="List">
	INSERT INTO WMS_CORE_LABEL
	(ID, LABEL_NO, RECEIPT_NO, RECEIPT_ITEM_NO, LABEL_STATUS, QC_RESULT_CODE, BOX_SN, FULL_BOX_QTY, BOX_QTY, END_FLAG, DEL, 
	WERKS, WH_NUMBER, LGORT, MATNR, MAKTX, BIN_CODE,  UNIT, SOBKZ, BATCH, LIFNR, LIKTX, PRODUCT_DATE, CREATOR, CREATE_DATE)
	select SEQ_WMS_CORE_LABEL.nextval,m.* from(
	<foreach collection="list" item="d" index="index" separator="union all">
	select 
		#{d.LABEL_NO},#{d.RECEIPT_NO},#{d.RECEIPT_ITEM_NO},#{d.LABEL_STATUS},#{d.QC_RESULT_CODE},#{d.BOX_SN},
		#{d.FULL_BOX_QTY},#{d.BOX_QTY},#{d.END_FLAG},#{d.DEL},#{d.WERKS},#{d.WH_NUMBER},#{d.LGORT},#{d.MATNR},
		#{d.MAKTX},#{d.BIN_CODE},#{d.UNIT},#{d.SOBKZ},#{d.BATCH},#{d.LIFNR},#{d.LIKTX},#{d.PRODUCT_DATE},#{d.CREATOR},#{d.CREATE_DATE}
	from dual
	</foreach>
	) m
	</insert>
	<select id="getPutAwayFlag" parameterType="Map" resultType="Map">
	SELECT AUTO_PUTAWAY_FLAG FROM WMS_CORE_WH_AREA WHERE WH_NUMBER = #{WH_NUMBER} AND STORAGE_AREA_CODE = #{STORAGE_AREA_CODE}
	</select>
	
	<update id="updateOutReturnHead" parameterType="Map">
	UPDATE WMS_OUT_RETURN_HEAD SET RETURN_STATUS = #{RETURN_STATUS} WHERE ID = #{HID}
	</update>
	<update id="updateOutReturnItem" parameterType="Map">
	UPDATE WMS_OUT_RETURN_ITEM SET ITEM_STATUS = #{ITEM_STATUS} WHERE RETURN_NO = #{RETURN_NO}
	</update>
	<select id="getOutReturnItemDetail" parameterType="Map" resultType="Map">
	SELECT * FROM WMS_OUT_RETURN_ITEM_D WHERE RETURN_NO = #{RETURN_NO} AND RETURN_ITEM_NO = #{RETURN_ITEM_NO}
	AND DEL != 'X'
	</select>
	<insert id="insertOutReturnItemDetail" parameterType="Map">
	INSERT INTO WMS_OUT_RETURN_ITEM_D
	(ID, RETURN_NO, RETURN_ITEM_NO, MATNR, LGORT, BATCH, RETURN_QTY, LIFNR,
	SOBKZ, BIN_CODE, REAL_QTY, ITEM_TEXT, RETURN_PEOPLE, MEMO, DEL, CREATOR, CREATE_DATE) VALUES 
	(SEQ_WMS_OUT_RETURN_ITEM_D.nextval,#{RETURN_NO},#{RETURN_ITEM_NO},#{MATNR},#{LGORT},#{BATCH},#{RETURN_QTY},#{LIFNR},
	#{SOBKZ},#{BIN_CODE},#{REAL_QTY},#{ITEM_TEXT},#{RETURN_PEOPLE},#{MEMO},'0',#{CREATOR},#{CREATE_DATE})
	</insert>
	<update id="updateOutReturnItemDetail" parameterType="Map">
	UPDATE WMS_OUT_RETURN_ITEM_D SET REAL_QTY = #{REAL_QTY} WHERE ID = #{DID}
	</update>
	<update id="updateCoreStockQty" parameterType="Map">
	UPDATE WMS_CORE_STOCK SET
		<if test="STOCK_QTY !=null and STOCK_QTY !=''">
		STOCK_QTY = NVL(STOCK_QTY,0) + ${STOCK_QTY}
		</if>
		<if test="FREEZE_QTY !=null and FREEZE_QTY !=''">
		FREEZE_QTY = NVL(FREEZE_QTY,0) + ${FREEZE_QTY}
		</if>
	WHERE WERKS = #{WERKS} AND WH_NUMBER = #{WH_NUMBER} AND MATNR = #{MATNR} AND LGORT = #{LGORT}
	AND BATCH = #{BATCH}
	AND BIN_CODE = #{BIN_CODE} AND NVL(LIFNR,' ') = #{LIFNR} AND SOBKZ = #{SOBKZ}
	</update>
	<insert id="insertCoreStockQty" parameterType="Map">
	INSERT INTO WMS_CORE_STOCK
	(ID, WERKS, WH_NUMBER, MATNR, MAKTX,  BATCH, 
	LGORT, BIN_CODE, LIFNR, LIKTX, SOBKZ, MEINS, STOCK_QTY,FREEZE_QTY, EDITOR, EDIT_DATE)
	VALUES(SEQ_WMS_CORE_STOCK.nextval, #{WERKS}  , #{WH_NUMBER}  , #{MATNR}  , #{MAKTX}  , #{BATCH}  ,
	#{LGORT}  , #{BIN_CODE}  , #{LIFNR}  , #{LIKTX}  , #{SOBKZ}  , #{UNIT}  , #{STOCK_QTY} ,#{FREEZE_QTY} , #{EDITOR} , #{EDIT_DATE}  )
	</insert>
	<update id="updateMOComponentQty" parameterType="Map">
	UPDATE WMS_SAP_MO_COMPONENT SET TL_QTY = NVL(TL_QTY,0) - ${RETURN_QTY}
	WHERE WERKS = #{WERKS} AND AUFNR = #{MO_NO} AND POSNR = #{MO_ITEM_NO} AND MATNR = #{MATNR}
	</update>
	
	<select id="getWorkshopReturnConfirmData" parameterType="Map" resultType="Map">
	SELECT H.ID HID,I.ID IID,D.ID DID,H.RETURN_TYPE,H.WERKS,H.WH_NUMBER,H.RETURN_NO,D.RETURN_ITEM_NO,I.MATNR,I.MAKTX,
	I.UNIT,D.RETURN_QTY,D.BATCH,D.LGORT,D.BIN_CODE,NVL(I.LIFNR,' ') LIFNR,I.LIKTX,D.SOBKZ,D.ITEM_TEXT,D.CREATE_DATE,
	I.MO_NO,I.MO_ITEM_NO,I.RSNUM,I.RSPOS,I.IO_NO,H.F_WERKS,I.COST_CENTER,I.WBS,I.SAP_OUT_NO,I.SAP_OUT_ITEM_NO,NVL(I.F_LGORT,' ') F_LGORT,
	I.PO_NO,I.PO_ITEM_NO,H.RETURN_STATUS,B.SAP_MOVE_TYPE,B.WMS_MOVE_TYPE,I.BUSINESS_NAME,I.BUSINESS_TYPE,H.RETURN_TYPE BUSINESS_CLASS,
	NVL(NVL(M.TEST_FLAG,(SELECT TEST_FLAG FROM WMS_C_QC_PLANT WHERE WERKS=H.WERKS AND BUSINESS_NAME = I.BUSINESS_NAME
	AND DEL = '0' AND START_DATE &lt;= (SELECT TO_CHAR(SYSDATE,'yyyy-mm-dd') AS NOWDATE FROM DUAL)
	AND END_DATE >= (SELECT TO_CHAR(SYSDATE,'yyyy-mm-dd') AS NOWDATE FROM DUAL)
	)),'-1') TEST_FLAG,T.HANDOVER_TYPE,
	I.RECEIPT_NO,I.RECEIPT_ITEM_NO
	FROM WMS_OUT_RETURN_HEAD H 
	LEFT JOIN WMS_OUT_RETURN_ITEM I ON H.RETURN_NO = I.RETURN_NO
	LEFT JOIN WMS_OUT_RETURN_ITEM_D D ON H.RETURN_NO = D.RETURN_NO AND D.RETURN_ITEM_NO = I.RETURN_ITEM_NO
	LEFT JOIN WMS_C_WMS_BUSINESS B ON I.BUSINESS_NAME = B.BUSINESS_NAME AND I.BUSINESS_TYPE = B.BUSINESS_TYPE 
	AND D.SOBKZ = B.SOBKZ
	LEFT JOIN WMS_C_QC_MAT M ON M.WERKS = H.WERKS AND M.MATNR = I.MATNR AND M.LIFNR = I.LIFNR
	LEFT JOIN WMS_C_HANDOVER_TYPE T ON T.WERKS = H.WERKS AND T.WH_NUMBER = H.WH_NUMBER AND 
	T.BUSINESS_NAME = I.BUSINESS_NAME AND T.DEL = '0'
	WHERE H.RETURN_NO = #{RETURN_NO} AND H.WERKS = #{WERKS} AND H.WH_NUMBER = #{WH_NUMBER}
	AND I.DEL = '0' AND D.DEL = '0' 
	ORDER BY I.RETURN_ITEM_NO
	</select>
	
	<select id="getSapMoComponentDate" parameterType="Map" resultType="Map">
	SELECT M.MAKTX,C.TL_QTY,C.MEINS,C.WERKS,
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE MO_NO=C.AUFNR AND MO_ITEM_NO = C.POSNR
	AND ITEM_STATUS='00' AND DEL = '0'
	),0) RETURN_QTY, --已创单数量
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE MO_NO=C.AUFNR AND MO_ITEM_NO = C.POSNR
	AND ITEM_STATUS='02' AND DEL = '0'
	),0) FINISH_QTY --已交接数量
	FROM WMS_SAP_MO_COMPONENT C 
	LEFT JOIN WMS_SAP_MATERIAL M ON C.MATNR = M.MATNR AND C.WERKS = M.WERKS
	WHERE C.RSNUM=#{RSNUM} AND C.RSPOS = #{RSPOS} AND C.MATNR = #{MATNR} AND C.BWART = '261' AND C.RGEKZ = 'X'
	</select>
	<select id="getSapMoComponentDate35" parameterType="Map" resultType="Map">
	SELECT M.MAKTX,C.TL_QTY,C.MEINS,C.WERKS,
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE MO_NO=C.AUFNR AND MO_ITEM_NO = C.POSNR
	AND ITEM_STATUS='00' AND DEL = '0'
	),0) RETURN_QTY, --已创单数量
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE MO_NO=C.AUFNR AND MO_ITEM_NO = C.POSNR
	AND ITEM_STATUS='02' AND DEL = '0'
	),0) FINISH_QTY --已交接数量
	FROM WMS_SAP_MO_COMPONENT C 
	LEFT JOIN WMS_SAP_MATERIAL M ON C.MATNR = M.MATNR AND C.WERKS = M.WERKS
	WHERE C.RSNUM=#{RSNUM} AND C.RSPOS = #{RSPOS} AND C.MATNR = #{MATNR} AND C.BWART = '261' AND NVL(C.RGEKZ,'0') != 'X'
	</select>
	
	<select id="getSapMoComponentDate36" parameterType="Map" resultType="Map">
	SELECT DISTINCT RI.MATNR,RI.MAKTX,RI.UNIT AS MEINS,RH.WERKS,
	(SELECT NVL(SUM(I.QTY_REAL),0) - NVL(SUM(I.QTY_CANCEL),0) AS TL_QTY FROM WMS_OUT_REQUIREMENT_ITEM I
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD H ON I.REQUIREMENT_NO = H.REQUIREMENT_NO WHERE
	H.WERKS = #{WERKS} AND H.WH_NUMBER = #{WH_NUMBER} AND I.BUSINESS_NAME = '42' AND I.BUSINESS_TYPE = '10'
	AND I.REQ_ITEM_STATUS IN ('04','05','06') AND I.MO_NO = RI.MO_NO AND I.MATNR = RI.MATNR
	) TL_QTY,
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE MO_NO = #{MO_NO} AND MATNR = RI.MATNR
	AND ITEM_STATUS='00' AND DEL = '0' AND BUSINESS_NAME = '36' AND BUSINESS_TYPE = '10'
	),0) RETURN_QTY, --已创单数量
	
	NVL((SELECT SUM(RD.REAL_QTY) FROM WMS_OUT_RETURN_ITEM_D RD LEFT JOIN WMS_OUT_RETURN_ITEM RI 
	ON RD.RETURN_NO = RI.RETURN_NO AND RD.RETURN_ITEM_NO = RI.RETURN_ITEM_NO
	WHERE RI.MO_NO = #{MO_NO} AND RD.MATNR = RI.MATNR  AND RI.BUSINESS_NAME = '36' AND RI.BUSINESS_TYPE = '10'
	AND RI.ITEM_STATUS='02' AND RI.DEL = '0'
	),0) FINISH_QTY, --已交接数量	
	(SELECT NVL(SUM(WI.QTY_CANCEL),0) FROM WMS_CORE_WMSDOC_ITEM WI WHERE 
	WI.RETURN_NO = RE_I.RETURN_NO AND WI.RETURN_ITEM_NO = RE_I.RETURN_ITEM_NO
	) QX_QTY 		--取消/冲销数量
	FROM WMS_OUT_REQUIREMENT_ITEM RI 
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD RH ON RI.REQUIREMENT_NO = RH.REQUIREMENT_NO
	LEFT JOIN WMS_OUT_RETURN_ITEM RE_I ON RE_I.MO_NO = RI.MO_NO AND RE_I.MO_ITEM_NO = RI.MO_ITEM_NO
	WHERE RI.MATNR = #{MATNR}
	AND RI.BUSINESS_NAME = '42' AND RI.BUSINESS_TYPE = '10' AND RI.MO_NO = #{MO_NO}
	AND RI.REQ_ITEM_STATUS IN ('04','05','06')
	</select>
	<select id="getSapMoComponentDate37" parameterType="Map" resultType="Map">
	SELECT DISTINCT RI.MATNR,RI.MAKTX,RI.UNIT AS MEINS,RH.WERKS,
	(SELECT NVL(SUM(I.QTY_REAL),0) AS TL_QTY FROM WMS_OUT_REQUIREMENT_ITEM I
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD H ON I.REQUIREMENT_NO = H.REQUIREMENT_NO WHERE
	H.WERKS = RH.WERKS AND H.WH_NUMBER = RH.WH_NUMBER AND I.IO_NO = RI.IO_NO AND I.MATNR = RI.MATNR
	) TL_QTY,
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE IO_NO = RI.IO_NO AND MATNR = RI.MATNR
	AND ITEM_STATUS='00' AND DEL = '0'
	),0) RETURN_QTY, --已创单数量
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE IO_NO = RI.IO_NO AND MATNR = RI.MATNR
	AND ITEM_STATUS='02' AND DEL = '0'
	),0) FINISH_QTY, --已交接数量
	(SELECT NVL(SUM(WI.QTY_CANCEL),0) FROM WMS_CORE_WMSDOC_ITEM WI WHERE 
	WI.RETURN_NO = RE_I.RETURN_NO AND WI.RETURN_ITEM_NO = RE_I.RETURN_ITEM_NO
	) QX_QTY 		--取消/冲销数量
	FROM WMS_OUT_REQUIREMENT_ITEM RI 
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD RH ON RI.REQUIREMENT_NO = RH.REQUIREMENT_NO
	LEFT JOIN WMS_OUT_RETURN_ITEM RE_I ON RE_I.MO_NO = RI.MO_NO AND RE_I.MO_ITEM_NO = RI.MO_ITEM_NO
	WHERE RI.MATNR = #{MATNR}
	AND RI.BUSINESS_NAME = '43' AND RI.BUSINESS_TYPE = '13' AND RI.IO_NO = #{IO_NO}
	AND RI.REQ_ITEM_STATUS IN ('04','05','06')
	</select>
	<select id="getSapMoComponentDate38" parameterType="Map" resultType="Map">
	SELECT DISTINCT RI.MATNR,RI.MAKTX,RI.UNIT AS MEINS,RH.WERKS,
	(SELECT NVL(SUM(I.QTY_REAL),0) AS TL_QTY FROM WMS_OUT_REQUIREMENT_ITEM I
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD H ON I.REQUIREMENT_NO = H.REQUIREMENT_NO WHERE
	H.WERKS = RH.WERKS AND H.WH_NUMBER = RH.WH_NUMBER AND I.COST_CENTER = RI.COST_CENTER AND I.MATNR = RI.MATNR
	) TL_QTY,
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE COST_CENTER = RI.COST_CENTER AND MATNR = RI.MATNR
	AND ITEM_STATUS='00' AND DEL = '0'
	),0) RETURN_QTY, --已创单数量
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE COST_CENTER = RI.COST_CENTER AND MATNR = RI.MATNR
	AND ITEM_STATUS='02' AND DEL = '0'
	),0) FINISH_QTY, --已交接数量
	(SELECT NVL(SUM(WI.QTY_CANCEL),0) FROM WMS_CORE_WMSDOC_ITEM WI WHERE 
	WI.RETURN_NO = RE_I.RETURN_NO AND WI.RETURN_ITEM_NO = RE_I.RETURN_ITEM_NO
	) QX_QTY 		--取消/冲销数量
	FROM WMS_OUT_REQUIREMENT_ITEM RI 
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD RH ON RI.REQUIREMENT_NO = RH.REQUIREMENT_NO
	LEFT JOIN WMS_OUT_RETURN_ITEM RE_I ON RE_I.MO_NO = RI.MO_NO AND RE_I.MO_ITEM_NO = RI.MO_ITEM_NO
	WHERE RI.MATNR = #{MATNR}
	AND RI.BUSINESS_NAME = '44' AND RI.BUSINESS_TYPE = '14'
	AND RI.REQ_ITEM_STATUS IN ('04','05','06')
	<if test="COST_CENTER !=null and COST_CENTER !=''">
	AND RI.COST_CENTER = #{COST_CENTER}
	</if>
	</select>
	<select id="getSapMoComponentDate39" parameterType="Map" resultType="Map">
	SELECT DISTINCT RI.MATNR,RI.MAKTX,RI.UNIT AS MEINS,RH.WERKS,
	(SELECT NVL(SUM(I.QTY_REAL),0) AS TL_QTY FROM WMS_OUT_REQUIREMENT_ITEM I
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD H ON I.REQUIREMENT_NO = H.REQUIREMENT_NO WHERE
	H.WERKS = RH.WERKS AND H.WH_NUMBER = RH.WH_NUMBER AND I.WBS = RI.WBS AND I.MATNR = RI.MATNR
	) TL_QTY,
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE WBS = RI.WBS AND MATNR = RI.MATNR
	AND ITEM_STATUS='00' AND DEL = '0'
	),0) RETURN_QTY, --已创单数量
	NVL((SELECT SUM(TOTAL_RETURN_QTY) FROM WMS_OUT_RETURN_ITEM WHERE WBS = RI.WBS AND MATNR = RI.MATNR
	AND ITEM_STATUS='02' AND DEL = '0'
	),0) FINISH_QTY, --已交接数量
	(SELECT NVL(SUM(WI.QTY_CANCEL),0) FROM WMS_CORE_WMSDOC_ITEM WI WHERE 
	WI.RETURN_NO = RE_I.RETURN_NO AND WI.RETURN_ITEM_NO = RE_I.RETURN_ITEM_NO
	) QX_QTY 		--取消/冲销数量
	FROM WMS_OUT_REQUIREMENT_ITEM RI 
	LEFT JOIN WMS_OUT_REQUIREMENT_HEAD RH ON RI.REQUIREMENT_NO = RH.REQUIREMENT_NO
	LEFT JOIN WMS_OUT_RETURN_ITEM RE_I ON RE_I.MO_NO = RI.MO_NO AND RE_I.MO_ITEM_NO = RI.MO_ITEM_NO
	WHERE RI.MATNR = #{MATNR} AND RI.WBS = #{WBS}
	AND RI.BUSINESS_NAME = '45' AND RI.BUSINESS_TYPE = '15'
	AND RI.REQ_ITEM_STATUS IN ('04','05','06')
	</select>
	<select id="getSapMoComponentDate40" parameterType="Map" resultType="Map">
	-- BUG 1484  支持从EXCEL，复制料号和数量，从物料主数据带出物料描述和单位，添加行项目和粘贴填入的数据不需要校验前期需求号领料数据。
	SELECT MATNR,MAKTX,MEINS,WERKS,0 AS TL_QTY,0 AS RETURN_QTY,0 AS FINISH_QTY,
	0 AS QX_QTY FROM WMS_SAP_MATERIAL WHERE WERKS = #{WERKS} AND MATNR = #{MATNR}
	</select>
	
	<insert id="insertWmsOutReturnHead" parameterType="map">
	INSERT INTO WMS_OUT_RETURN_HEAD (ID,RETURN_NO,RETURN_TYPE,RETURN_STATUS,
	F_WERKS,WERKS,F_WH_NUMBER,WH_NUMBER,LIFNR,
	LIKTX,HEADER_TXT,IS_AUTO,DEL,CREATOR,
	CREATE_DATE,EDITOR,EDIT_DATE)
	VALUES(SEQ_WMS_OUT_RETURN_HEAD.nextval,#{RETURN_NO},#{RETURN_TYPE},#{RETURN_STATUS},
	#{F_WERKS},#{WERKS},#{F_WH_NUMBER},#{WH_NUMBER},#{LIFNR},
	#{LIKTX},#{HEADER_TXT},#{IS_AUTO},#{DEL},#{CREATOR},
	#{CREATE_DATE},#{EDITOR},#{EDIT_DATE})
	</insert>
	<insert id="insertWmsOutReturnItem" parameterType="map">
	INSERT INTO WMS_OUT_RETURN_ITEM
	(ID, RETURN_NO, RETURN_ITEM_NO, BUSINESS_NAME, BUSINESS_TYPE, 
	WERKS, WH_NUMBER, F_LGORT, MATNR, MAKTX, 
	UNIT, TOTAL_RETURN_QTY, RETURN_PEOPLE, RETURN_REASON_DESC, ITEM_STATUS, 
	MEMO, RECEIPT_NO, RECEIPT_ITEM_NO, LIFNR, LIKTX, 
	PO_NO, PO_ITEM_NO, SAP_OUT_NO, SAP_OUT_ITEM_NO, MO_NO, 
	MO_ITEM_NO, RSNUM, RSPOS, COST_CENTER, IO_NO, 
	WBS, SAP_MATDOC_NO, SAP_MATDOC_ITEM_NO, INBOUND_NO, INBOUND_ITEM_NO, 
	SQE, PICK_FLAG, DEL, CREATOR, CREATE_DATE, 
	EDITOR, EDIT_DATE,LABEL_NO,REQUIREMENT_NO,REQUIREMENT_ITEM_NO)
	VALUES(SEQ_WMS_OUT_RETURN_ITEM.nextval,#{RETURN_NO},#{RETURN_ITEM_NO},#{BUSINESS_NAME},#{BUSINESS_TYPE},
	#{WERKS},#{WH_NUMBER},#{F_LGORT},#{MATNR},#{MAKTX},
	#{UNIT},#{TOTAL_RETURN_QTY},#{RETURN_PEOPLE},#{RETURN_REASON_DESC},#{ITEM_STATUS},
	#{MEMO},#{RECEIPT_NO},#{RECEIPT_ITEM_NO},#{LIFNR},#{LIKTX},
	#{PO_NO},#{PO_ITEM_NO},#{SAP_OUT_NO},#{SAP_OUT_ITEM_NO},#{MO_NO},
	#{MO_ITEM_NO},#{RSNUM},#{RSPOS},#{COST_CENTER},#{IO_NO},
	#{WBS},#{SAP_MATDOC_NO},#{SAP_MATDOC_ITEM_NO},#{INBOUND_NO},#{INBOUND_ITEM_NO},
	#{SQE},#{PICK_FLAG},#{DEL},#{CREATOR},#{CREATE_DATE},
	#{EDITOR},#{EDIT_DATE},#{LABEL_NO},#{REQUIREMENT_NO},#{REQUIREMENT_ITEM_NO})
	</insert>
	<insert id="insertWmsOutReturnItemDetail" parameterType="map">
	INSERT INTO WMS_OUT_RETURN_ITEM_D
	(ID, RETURN_NO, RETURN_ITEM_NO, MATNR, LGORT, 
	F_BATCH, BATCH, RETURN_QTY, LIFNR, SOBKZ, 
	BIN_CODE, BIN_CODE_XJ, XJ_QTY, REAL_QTY, ITEM_TEXT, 
	RETURN_PEOPLE, MEMO, DEL, CREATOR, CREATE_DATE, 
	EDITOR, EDIT_DATE,LABEL_NO)
	VALUES(SEQ_WMS_OUT_RETURN_ITEM_D.nextval,#{RETURN_NO},#{RETURN_ITEM_NO},#{MATNR},#{LGORT},
	#{F_BATCH},#{BATCH},#{RETURN_QTY},#{LIFNR},#{SOBKZ},
	#{BIN_CODE},#{BIN_CODE_XJ},#{XJ_QTY},#{REAL_QTY},#{ITEM_TEXT},
	#{RETURN_PEOPLE},#{MEMO},#{DEL},#{CREATOR},#{CREATE_DATE},
	#{EDITOR},#{EDIT_DATE},#{LABEL_NO})
	</insert>
	<select id="getPlantInfoByWerks" parameterType="Map" resultType="Map">
	SELECT * FROM WMS_C_WH WHERE WERKS = #{WERKS}
	</select>
	<select id="getMoHeadHxQty" parameterType="String" resultType="int">
	SELECT NVL(SUM(HX_QTY),0) AS HX_QTY FROM WMS_HX_MO_ITEM WHERE AUFNR = #{AUFNR}
	</select>
	<select id="getSapMoCount" parameterType="Map" resultType="int">
	SELECT COUNT(*) AS MO_COUNT FROM WMS_SAP_MO_HEAD WHERE AUFNR = #{AUFNR} AND WERKS = #{WERKS}
	</select>
	<select id="getSapPoCount" parameterType="Map" resultType="int">
	SELECT COUNT(*) AS PO_COUNT FROM WMS_SAP_PO_HEAD WHERE EBELN = #{PONO}
	</select>
	<select id="getSapPoStatus" parameterType="Map" resultType="Map">
	SELECT H.ID AS HID,H.LIFNR,NVL(H.FRGRL,'0') FRGRL,I.ID AS IID,NVL(I.ELIKZ,'0') ELIKZ ,
	NVL(I.LOEKZ,'0') LOEKZ,NVL(H.BSART,'0') BSART FROM WMS_SAP_PO_HEAD H 
	LEFT JOIN WMS_SAP_PO_ITEM I ON H.EBELN = I.EBELN
	WHERE H.EBELN = #{PONO}
	</select>
	<select id="getSapMoStatus" parameterType="Map" resultType="String">
	SELECT ISTAT_TXT FROM WMS_SAP_MO_HEAD WHERE AUFNR = #{AUFNR} AND WERKS = #{WERKS}
	</select>
	<select id="getPlantLgortInfo" parameterType="Map" resultType="Map">
	SELECT * FROM WMS_SAP_PLANT_LGORT WHERE WERKS = #{WERKS} AND LGORT = #{LGORT} AND SOBKZ = #{SOBKZ} AND DEL = 0
	</select>
	<select id="getWorkshopReturnOriBatchInfo" parameterType="Map" resultType="Map">
	SELECT WM_CONCAT(DISTINCT H.WERKS) WERKS,WM_CONCAT(DISTINCT H.WH_NUMBER) WH_NUMBER,
	CONCAT(CONCAT('(',REPLACE(WM_CONCAT(CONCAT(CONCAT('(',CONCAT(CONCAT(CONCAT('MO_NO=''',I.MO_NO),
	''' AND MO_ITEM_NO ='''),I.MO_ITEM_NO)),''')')),',',' OR ')),')') MO_SQL
	FROM WMS_OUT_RETURN_HEAD H 
	LEFT JOIN WMS_OUT_RETURN_ITEM I ON H.RETURN_NO = I.RETURN_NO
	WHERE H.WERKS = #{WERKS} AND H.WH_NUMBER = #{WH_NUMBER} AND H.RETURN_NO = #{RETURN_NO} AND I.DEL = '0' 
	</select>
	<select id="getWorkshopReturnOriBatchList" parameterType="Map" resultType="Map">
	SELECT H.ID HID,I.ID IID,H.WERKS,H.WH_NUMBER,'1RT0155' AS RETURN_NO,I.MATNR,I.MAKTX,I.UNIT,
	(SELECT TOTAL_RETURN_QTY FROM WMS_OUT_RETURN_ITEM WHERE RETURN_NO = #{RETURN_NO} 
	AND MO_NO = I.MO_NO AND MO_ITEM_NO = I.MO_ITEM_NO) RETURN_QTY,
	I.RECEIVE_LGORT LGORT,I.LIFNR,I.SOBKZ,I.CREATE_DATE
	FROM WMS_OUT_REQUIREMENT_HEAD H
	LEFT JOIN WMS_OUT_REQUIREMENT_ITEM I ON H.REQUIREMENT_NO = I.REQUIREMENT_NO
	WHERE H.WERKS = #{WERKS} AND H.WH_NUMBER = #{WH_NUMBER}
	AND ${MO_SQL}
	AND MATNR IN (SELECT MATNR FROM WMS_OUT_RETURN_ITEM WHERE RETURN_NO = #{RETURN_NO})
	</select>

</mapper>